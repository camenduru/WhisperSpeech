<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>WhisperSpeech - Semantic to acoustic token modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="WhisperSpeech - Semantic to acoustic token modeling">
<meta property="og:description" content="">
<meta property="og:image" content="https://collabora.github.io/WhisperSpeech/4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-18-output-2.png">
<meta property="og:site-name" content="WhisperSpeech">
<meta property="og:image:height" content="415">
<meta property="og:image:width" content="416">
<meta name="twitter:title" content="WhisperSpeech - Semantic to acoustic token modeling">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://collabora.github.io/WhisperSpeech/4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-18-output-2.png">
<meta name="twitter:image-height" content="415">
<meta name="twitter:image-width" content="416">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">WhisperSpeech</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/collabora/WhisperSpeech" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Semantic to acoustic token modeling</li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">WhisperSpeech</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dataset preparation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">I can has speech? What data WhisperSpeech needs?</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-the-dataset" id="toc-load-the-dataset" class="nav-link active" data-scroll-target="#load-the-dataset">Load the dataset</a></li>
  <li><a href="#load_dataset" id="toc-load_dataset" class="nav-link" data-scroll-target="#load_dataset">load_dataset</a></li>
  <li><a href="#lang_to_id" id="toc-lang_to_id" class="nav-link" data-scroll-target="#lang_to_id">lang_to_id</a></li>
  <li><a href="#model" id="toc-model" class="nav-link" data-scroll-target="#model">Model</a>
  <ul>
  <li><a href="#cmlmvisual" id="toc-cmlmvisual" class="nav-link" data-scroll-target="#cmlmvisual">CMLMVisual</a></li>
  <li><a href="#apply_rotary_pos_emb" id="toc-apply_rotary_pos_emb" class="nav-link" data-scroll-target="#apply_rotary_pos_emb">apply_rotary_pos_emb</a></li>
  <li><a href="#rotate_half" id="toc-rotate_half" class="nav-link" data-scroll-target="#rotate_half">rotate_half</a></li>
  <li><a href="#rotary" id="toc-rotary" class="nav-link" data-scroll-target="#rotary">Rotary</a></li>
  <li><a href="#multiheadattention" id="toc-multiheadattention" class="nav-link" data-scroll-target="#multiheadattention">MultiHeadAttention</a></li>
  <li><a href="#residualattentionblock" id="toc-residualattentionblock" class="nav-link" data-scroll-target="#residualattentionblock">ResidualAttentionBlock</a></li>
  <li><a href="#sadelartransformer" id="toc-sadelartransformer" class="nav-link" data-scroll-target="#sadelartransformer">SADelARTransformer</a></li>
  <li><a href="#tunables" id="toc-tunables" class="nav-link" data-scroll-target="#tunables">Tunables</a></li>
  <li><a href="#rand" id="toc-rand" class="nav-link" data-scroll-target="#rand">rand</a></li>
  <li><a href="#delsumdecoder" id="toc-delsumdecoder" class="nav-link" data-scroll-target="#delsumdecoder">DelSumDecoder</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/collabora/WhisperSpeech/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Semantic to acoustic token modeling</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pylab <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Audio, HTML, display</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="load-the-dataset" class="level3">
<h3 class="anchored" data-anchor-id="load-the-dataset">Load the dataset</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>shards <span class="op">=</span> [<span class="bu">str</span>(x) <span class="cf">for</span> x <span class="kw">in</span> Path(<span class="st">'../ll-small-spk_emb-train/'</span>).glob(<span class="st">'*.tar.gz'</span>)]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>speakers <span class="op">=</span> make_speaker_map(shards)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> wds.WebDataset(wds.SimpleShardList(shards)).compose(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    wds.decode(),</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">#wds.map_dict(**{'spk_emb.npy':np.nan_to_num}),</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    speaker_id_extractor(speakers),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> ds: <span class="cf">break</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'__key__': 'small/92/woodbeyondtheworld_0810_librivox_64kb_mp3/woodbeyondworld_01_morris_64kb_052',
 '__url__': '../ll-small-spk_emb-train/train-000042.tar.gz',
 'atoks.npy': array([[121, 408, 408, ...,  62,  62, 408],
        [913, 913, 518, ..., 518, 424, 518],
        [786, 786, 989, ..., 786, 989,  36],
        [673, 741, 215, ..., 673, 838, 741]], dtype=int16),
 'speaker': tensor(478),
 'spk_emb.npy': array([ 1.1235610e+00,  5.8436203e+00, -1.9499685e+01,  2.8804701e+01,
         2.0494364e+01, -2.2053741e+01,  7.6806836e+00,  3.2861352e+00,
        -4.9300327e+00,  2.4251037e+00,  9.0157528e+00,  3.7315593e+00,
         2.3731998e+01, -2.5883791e+00, -7.4421372e+00,  9.5579786e+00,
         1.7692202e+00, -1.5219135e+01,  7.7783313e+00,  7.4359097e+00,
        -2.3943136e+01, -1.9906338e+01, -5.1885333e+00, -2.7640383e+01,
        -1.5681701e+01, -1.9959921e+01,  2.9790370e+00,  6.7343438e-01,
        -1.2512109e+01, -4.4835960e+01, -1.0508450e+01,  1.4617002e+00,
        -1.8717539e+00,  2.5555685e+01,  3.0684395e+01,  6.7171302e+00,
        -1.2909344e+01,  4.3368065e+01,  2.0671967e+01,  1.5564143e+01,
        -7.8333483e+00, -1.0562061e+00, -2.2349403e+01,  1.1468982e+01,
        -2.2061237e+01, -8.5499229e+00, -2.6156527e+01,  3.2080727e+01,
         6.1796584e+00, -2.7032955e+01, -5.9643879e+00,  1.2451406e+01,
        -2.3904823e+01, -3.9363089e+00,  6.3037024e+00, -7.9090133e+00,
        -3.7173223e+00, -3.6386077e+00, -6.6259108e+00,  1.7716342e+00,
        -1.6216227e+01,  2.6865524e+01, -1.2317332e+01, -2.8274618e+01,
         4.6517792e+00, -3.8759856e+00, -1.6775990e+01, -2.2079468e+01,
        -4.2092411e+01, -4.4479141e+01, -2.0711538e+01, -1.6164698e+01,
         3.8429016e+01, -4.1416245e+01, -1.2472393e+01,  6.4069567e+00,
         6.7559228e+00,  4.6695469e+01, -2.2287695e+01,  2.9939398e+01,
         3.3407341e+01,  4.0268913e+01, -4.2432888e+01,  4.1613609e+01,
        -9.5481253e+00, -2.4510454e+01, -6.2197542e+00,  7.2644053e+00,
        -9.3830795e+00,  4.3495655e+00, -1.0903836e+01, -1.6092113e+01,
         1.2240689e-01,  6.7009211e+00,  6.8789369e-01, -2.9251566e-02,
         2.3128731e+01, -3.0957806e+00, -3.9258377e+01,  1.5729831e+01,
         1.5961056e+01, -1.9289993e+01,  3.2042217e+01, -2.4587923e+01,
        -2.8504160e+01, -2.6693787e+01, -1.1761628e+01,  6.0839992e+00,
         1.6525909e+00, -1.2288855e+01, -6.8123260e+00,  2.9697933e+00,
         1.9132233e+01,  4.6158290e+00,  3.5110166e+00, -3.8236709e+00,
         1.5158258e+01,  5.2713923e+00,  1.8222237e+01, -5.2697887e+00,
        -1.9295088e+01, -9.1018333e+00,  1.6366573e+01,  1.4525748e+01,
         1.4491566e+01,  2.9242842e+01, -3.5604511e+01, -3.6368675e+01,
        -7.4584441e+00, -1.3403483e+01,  1.4968843e+01,  6.0060840e+00,
         3.4808655e+01,  9.1503677e+00, -4.4954308e+01, -1.8842575e+01,
         3.1092732e+00, -1.6604448e+01, -1.0231958e+01,  1.9190975e+01,
        -1.0321778e+01,  8.0527906e+00, -2.7579870e+01, -1.6237648e+01,
        -3.1789136e+00,  5.0894012e+01, -1.5539320e+01,  1.1445044e+01,
        -2.9825470e+00,  1.0431014e+01,  2.1814329e+01,  3.0343357e+01,
        -1.1645328e+01, -7.4340162e+00,  1.7107403e+01, -2.2531157e+00,
         5.5267587e+00, -1.8857710e+01, -8.0599318e+00, -4.5564051e+00,
        -9.2709818e+00,  8.0679016e+00,  5.1750154e+00,  3.8538044e+01,
         2.0465071e+00,  3.5098596e+00,  2.5915186e+01,  1.1697753e+01,
        -1.9595600e+01, -1.3467363e+01,  2.6499031e+01, -2.8732559e+01,
        -1.5005890e+01,  5.5529163e+01,  9.7561270e-01, -1.6080178e+00,
        -4.1144985e+01,  2.1760839e+01,  2.3028690e+01,  1.8357796e+01,
         6.6818876e+00, -6.1911430e+01, -1.5687291e+01,  2.9821669e+01,
        -5.3033910e+00, -1.3208115e+01, -4.7617192e+00, -2.2928539e+01,
         5.2911353e+00, -1.3578352e+00, -1.5183935e+01, -2.1150051e+01],
       dtype=float32),
 'stoks.npy': array([140, 261, 197, 283, 227, 227, 300, 300, 196,  71,  71,  71,  71,
         71,  71, 172, 172, 396, 396, 510, 494, 402, 498, 498, 255,  25,
        126, 126, 126, 126, 369, 220, 220, 437, 359, 439, 339, 339, 349,
        141, 192, 383, 201, 372, 192, 163, 163, 309, 272, 272, 272, 352,
         95, 141, 330, 330, 330, 330, 506, 506,  10,  10, 178, 258, 178,
        178, 178, 493, 339, 339, 215, 118, 348, 348, 348, 459, 265, 240,
        499, 507, 507, 507, 153, 153, 188,   1,   1,   4, 363, 363, 433,
        359, 359, 359, 164,  26, 394,  18,   9,  50, 377, 199, 480, 480,
         81,  21, 249, 249, 352, 448, 398, 380, 380, 281, 396,  55,  55,
         55, 281,  94, 281,  94,  55,  55, 140,  94, 140, 140, 396, 255,
        255, 147, 335, 119, 404,  52, 215, 215, 215, 215, 196, 196, 196,
        196, 158, 158, 158, 158, 158, 359, 359, 192, 196, 178, 258,  67,
        178, 253, 253, 467, 206, 101,   2, 425, 425, 270, 373, 493, 493,
        104, 104, 487, 399, 381, 381, 448, 230, 230, 367, 409, 312,   7,
         52,  91,  91,  91, 246, 246, 119, 330, 330, 330, 506,  83,  83,
         83, 291, 291, 380, 421, 421, 281, 421, 421,  55,  94,  94,  94,
         55,  94,  94,  94,  55,  55,  55,  94,  55,  55, 167, 167, 140,
        140, 262, 262, 262, 262, 169, 169, 180, 243, 387, 430, 148,  84,
        229, 229, 229, 448, 448, 448,  99,  71,  71,  71,  71,  71, 172,
        172, 172,  71, 510, 396, 498, 255, 255, 378,  30, 110,  17,  17,
         17, 411, 124, 399, 458, 279,   1,   1, 169, 304, 304,  52, 154,
        154, 131, 496, 458, 458, 201, 420, 417, 425, 425, 425, 425, 201,
        201, 372, 442, 244, 128, 375, 375,  23,  93,  93, 196, 196, 398,
        178, 328, 178, 178, 178, 253, 255, 255,  30,  30, 426, 426, 377,
        496,  26,  61, 146, 289, 438, 438, 331, 331, 331, 331, 331, 481,
        180, 458, 408,  24,  24, 319,  26, 207, 207, 442, 424, 424, 171,
        215, 215, 215, 271, 271, 284, 284,  61, 177, 256, 256, 256, 373,
        373, 171, 395, 395, 395, 359, 162,  63, 148, 379, 257, 257, 291,
        291, 291, 178,  60, 209, 380, 380, 172, 172, 172, 172, 172, 172,
        396, 396, 396, 396, 396, 402,  53,  53,  53, 162, 495, 176, 176,
         25,  25, 289, 141, 141, 330, 330, 506, 487, 378, 306, 355, 137,
        199, 502, 304, 304,  59,  59, 185, 185, 114, 374, 369, 369, 369,
        164, 243, 243, 243, 106, 403, 403, 403, 337, 337, 187, 187, 304,
        304, 293, 293, 191, 191,  29,  29, 264, 264, 287, 287, 310, 310,
        310, 310, 196, 178, 178, 178, 178, 178, 328, 178, 396, 166, 166,
        440, 440, 440, 385, 163, 484, 244, 508,  52,  52,  52, 271,  79,
        212, 306, 442, 442, 467, 213, 298, 298, 298, 309, 174, 174, 174,
          5,  30, 383, 192, 282, 282, 196, 405, 265, 265, 141, 112, 183,
        356, 185, 137, 373, 177, 372,  68,  40,   3,   3, 304, 304, 330,
        227, 205, 404, 184, 191, 191, 211, 355, 355, 137, 137, 286, 461,
        461, 380, 418, 156,  96], dtype=int16)}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> []</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>spk_ids <span class="op">=</span> []</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>spk_embs <span class="op">=</span> []</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> progress_bar(ds, total<span class="op">=</span><span class="dv">64</span>):</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    keys.append(s[<span class="st">'__key__'</span>])</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    spk_ids.append(s[<span class="st">'speaker'</span>])</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    spk_embs.append(torch.tensor(s[<span class="st">'spk_emb.npy'</span>]))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>spk_ids <span class="op">=</span> torch.stack(spk_ids)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>spk_embs <span class="op">=</span> torch.stack(spk_embs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="64" class="" max="64" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [64/64 00:00&lt;00:00]
    </div>
    
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>atoks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([], size=(4, 0), dtype=torch.int16)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> s <span class="kw">in</span> progress_bar(ds, total<span class="op">=</span><span class="dv">5000</span>):</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> torch.tensor(s[<span class="st">'spk_emb.npy'</span>]).isnan().<span class="bu">any</span>():</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        atoks <span class="op">=</span> torch.tensor(s[<span class="st">'atoks.npy'</span>])</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(s[<span class="st">'__url__'</span>], s[<span class="st">'__key__'</span>], atoks.shape)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">#         vocoder.decode_to_notebook(torch.tensor(atoks[:,:(atoks==-100).nonzero()[0,1]]).cuda())</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 00:02&lt;00:00]
    </div>
    
</div>
<div class="cell-output cell-output-stdout">
<pre><code>../ll-small-spk_emb-train/train-000042.tar.gz small/2004/chronicle_louisbourg_0711_librivox_64kb_mp3/chronicle_louisbourg_04_wood_64kb_085 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/2368/dick_sands_the_boy_captain_act_librivox_64kb_mp3/dicksands_15_verne_64kb_011 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/3657/turmoil_0908_librivox_64kb_mp3/turmoil_04_tarkington_64kb_006 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/3157/institutes_christian_religion2_1003_librivox_64kb_mp3/institutesofchristianreligion2_13_calvin_64kb_052 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/107/tramp_abroad_jg_0906_librivox_64kb_mp3/tramp_20_twain_64kb_033 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/3488/jungle_tw_0908_librivox_64kb_mp3/thejungle_25_sinclair_64kb_095 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/107/tramp_abroad_jg_0906_librivox_64kb_mp3/tramp_27_twain_64kb_010 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/1212/goldenbowl_0905_librivox_64kb_mp3/goldenbowl_4-26_james_64kb_009 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/960/history_of_holland__0707_librivox_64kb_mp3/historyofholland_06_gedmundson_64kb_102 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000042.tar.gz small/36/canterburytales_librivox_64kb_mp3/canterburytales_08_chaucer_64kb_032 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/3157/workers_together_tg_librivox_64kb_mp3/workerstogether_13_pansy_64kb_035 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/3157/workers_together_tg_librivox_64kb_mp3/workerstogether_18_pansy_64kb_021 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/7342/extermination_american_bison_1503_librivox_64kb_mp3/exterminationamericanbison_09_hornaday_64kb_029 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/3157/commentary_galatians_1010_librivox_64kb_mp3/comment_galatians_19_luther_64kb_048 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/2368/dick_sands_the_boy_captain_act_librivox_64kb_mp3/dicksands_06_verne_64kb_008 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/2518/shortlifelincoln_0809_librivox_64kb_mp3/shortlifeoflincoln_05_nicolay_64kb_055 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/1938/memoirs_casanova1_0812_librivox_64kb_mp3/casanova1_01_casanova_64kb_116 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000014.tar.gz small/1121/shortlifelincoln_0809_librivox_64kb_mp3/shortlifeoflincoln_02_nicolay_64kb_091 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/94/revelations_of_divine_love_drb_librivox_64kb_mp3/revelations_34_julian_64kb_004 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/2368/dick_sands_the_boy_captain_act_librivox_64kb_mp3/dicksands_17_verne_64kb_032 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/3657/turmoil_0908_librivox_64kb_mp3/turmoil_04_tarkington_64kb_053 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/705/man_property_librivox_64kb_mp3/manofproperty_12_galsworthy_64kb_072 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/78/lectures_landscape_librivox_64kb_mp3/lecturesonlandscape_1_ruskin_64kb_081 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/167/short_story_008_64kb_mp3/in_penal_colony_kafka_py_64kb_156 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/3157/institutes_christian_religion2_1003_librivox_64kb_mp3/institutesofchristianreligion2_15_calvin_64kb_014 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/110/canterburytales_librivox_64kb_mp3/canterburytales_13_chaucer_64kb_108 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/167/life_mediaeval_city_py_librivox_64kb_mp3/mediaevalyork_6_benson_64kb_038 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/2827/soldierlife_n-virginia_0808_librivox_64kb_mp3/soldier_life_09_mccarthy_64kb_040 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/1212/goldenbowl_0905_librivox_64kb_mp3/goldenbowl_3-14_james_64kb_004 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/167/life_mediaeval_city_py_librivox_64kb_mp3/mediaevalyork_3_benson_64kb_043 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/1724/herodotus_histories_3_0912_librivox_64kb_mp3/histories3_03_herodotus_64kb_043 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/1259/sonnets_etk_librivox_64kb_mp3/sonnets_10_shakespeare_64kb_022 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000036.tar.gz small/2827/soldierlife_n-virginia_0808_librivox_64kb_mp3/soldier_life_08_mccarthy_64kb_086 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000041.tar.gz small/16/little_lame_prince_librivox_64kb_mp3/little_lame_prince_11_64kb_034 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000041.tar.gz small/204/twenty-four_hours_a_day_librivox_64kb_mp3/live_on_24_hours_11_bennett_64kb_019 torch.Size([4, 0])
../ll-small-spk_emb-train/train-000041.tar.gz small/3490/security_0912_librivox_64kb_mp3/security_01_anderson_64kb_091 torch.Size([4, 0])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>spk_embs.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>torch.Size([64, 192])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>spk_embs[spk_embs.isnan().<span class="bu">any</span>(dim<span class="op">=-</span><span class="dv">1</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan,
         nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan,
         nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan,
         nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan,
         nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan,
         nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan,
         nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan,
         nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan, nan]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>keys[<span class="dv">16</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'small/2368/dick_sands_the_boy_captain_act_librivox_64kb_mp3/dicksands_13_verne_64kb_040'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>spk_embs.isnan().<span class="bu">any</span>(dim<span class="op">=-</span><span class="dv">1</span>).nonzero()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[16]])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>spk_ids.unique(return_counts<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(tensor([  6,   8,  10,  13,  50,  54,  55,  58, 104, 105, 117, 118, 122, 151,
         154, 159, 160, 162, 165, 166, 230, 249, 251, 252, 256, 304, 318, 335,
         348, 351, 436, 437, 441]),
 tensor([1, 2, 1, 5, 2, 1, 2, 2, 1, 5, 1, 3, 1, 1, 1, 1, 1, 3, 1, 1, 1, 8, 1, 3,
         1, 2, 1, 1, 1, 1, 1, 6, 1]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>spk_embs_sorted <span class="op">=</span> spk_embs[spk_ids.argsort()]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>spk_embs_sorted <span class="op">=</span> spk_embs_sorted <span class="op">/</span> torch.linalg.norm(spk_embs_sorted, dim<span class="op">=-</span><span class="dv">1</span>, keepdim<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>spk_ids[spk_ids.argsort()]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([  6,   8,   8,  10,  13,  13,  13,  13,  13,  50,  50,  54,  55,  55,
         58,  58, 104, 105, 105, 105, 105, 105, 117, 118, 118, 118, 122, 151,
        154, 159, 160, 162, 162, 162, 165, 166, 230, 249, 249, 249, 249, 249,
        249, 249, 249, 251, 252, 252, 252, 256, 304, 304, 318, 335, 348, 351,
        436, 437, 437, 437, 437, 437, 437, 441])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>spk_embs.shape, spk_embs_sorted.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(torch.Size([64, 192]), torch.Size([64, 192]))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>spk_embs[<span class="dv">7</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([ 10.9192,  21.0639,  31.8316,  26.4277, -11.9478, -16.9772,   9.8850,
         14.1262, -25.3061,  17.9711,   7.4842, -13.7446,  53.2348, -14.6249,
         33.2339,  30.6775, -30.1435,  10.7685, -34.4598, -22.7670,  -1.3739,
         -7.3938,   9.4670, -54.6743, -26.5816,  12.9000,  24.8319,   5.1894,
          5.9923,   1.9081, -12.8851,  13.7233, -19.0305,  -6.9721,   8.9085,
          1.0220,  -3.3709,  -1.8594,   2.2395,   8.2434,  -1.9964,   1.6737,
        -20.1469,   9.7832,   7.2308,  -5.4863, -10.8640,  42.5644,  23.0737,
         10.5803,   7.1244, -15.5125,  25.2653,  -7.2884,   4.9547, -29.7662,
         36.5694, -25.7725, -11.3807,  14.1201,  28.5292,  12.3695, -16.9479,
         -3.4876,  10.2940,  50.5857, -10.8610,  -7.2309,  11.9308, -12.2493,
          8.0105,  42.0778,   4.5632,  22.1200,  -2.0631,  14.0806, -31.6213,
        -11.6051, -30.5606,  19.9258,   2.2697,  38.7727,  21.6024,   7.1776,
         10.6035,  -9.8909,   1.0948, -25.6604, -13.7611,  23.5924, -16.7728,
        -16.4521,   2.0036,  20.1352,  30.7880, -11.8033,   9.5556,  -6.3908,
        -24.4808, -12.7333, -48.8263,  23.4967,   7.4764,   2.0592, -19.4115,
         30.3473,  -9.8033,  -9.9581,  11.7288,   3.2110,  -5.1365,  33.4665,
         10.0062, -11.7233, -11.7427,  10.0423, -13.5458,   1.4288,  32.8403,
          4.3261, -14.3409,  29.0851,  -1.1367,   5.7459, -19.7679,  11.2302,
          8.5273, -20.7811,  23.9594, -33.1993, -21.8522, -41.1648,   3.1314,
          4.5973,  15.6185,   3.7323,  35.3689,   1.0356,  16.9172,  15.7397,
         -5.8225,   3.2487, -50.0901,  -5.8262, -16.0680,  30.6645, -28.5780,
          9.1478, -34.4440,  47.6026, -48.6780, -46.5683, -16.2805,   4.7031,
         13.4741, -17.9462,  13.9286,  23.7837, -16.1009,   4.7591, -27.9657,
        -34.5504,   5.7164,  10.8002,  -1.5938,   2.3044,  24.8650, -19.0896,
        -30.1856,  -6.6452,  17.3174,  -1.4160, -14.2195,   1.1764,  -8.5488,
         -4.5568,  16.9410, -15.4112,  26.1877,  -1.7219,  -9.6525, -51.4880,
        -38.2531,  -7.5775,  36.5486, -35.8049,  -8.7410,   9.8326,  13.8151,
         13.3137, -46.4688,  -0.6205])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>plt.imshow(spk_embs_sorted <span class="op">@</span> spk_embs_sorted.T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>&lt;matplotlib.image.AxesImage&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>whisper.tokenizer.TO_LANGUAGE_CODE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'english': 'en',
 'chinese': 'zh',
 'german': 'de',
 'spanish': 'es',
 'russian': 'ru',
 'korean': 'ko',
 'french': 'fr',
 'japanese': 'ja',
 'portuguese': 'pt',
 'turkish': 'tr',
 'polish': 'pl',
 'catalan': 'ca',
 'dutch': 'nl',
 'arabic': 'ar',
 'swedish': 'sv',
 'italian': 'it',
 'indonesian': 'id',
 'hindi': 'hi',
 'finnish': 'fi',
 'vietnamese': 'vi',
 'hebrew': 'he',
 'ukrainian': 'uk',
 'greek': 'el',
 'malay': 'ms',
 'czech': 'cs',
 'romanian': 'ro',
 'danish': 'da',
 'hungarian': 'hu',
 'tamil': 'ta',
 'norwegian': 'no',
 'thai': 'th',
 'urdu': 'ur',
 'croatian': 'hr',
 'bulgarian': 'bg',
 'lithuanian': 'lt',
 'latin': 'la',
 'maori': 'mi',
 'malayalam': 'ml',
 'welsh': 'cy',
 'slovak': 'sk',
 'telugu': 'te',
 'persian': 'fa',
 'latvian': 'lv',
 'bengali': 'bn',
 'serbian': 'sr',
 'azerbaijani': 'az',
 'slovenian': 'sl',
 'kannada': 'kn',
 'estonian': 'et',
 'macedonian': 'mk',
 'breton': 'br',
 'basque': 'eu',
 'icelandic': 'is',
 'armenian': 'hy',
 'nepali': 'ne',
 'mongolian': 'mn',
 'bosnian': 'bs',
 'kazakh': 'kk',
 'albanian': 'sq',
 'swahili': 'sw',
 'galician': 'gl',
 'marathi': 'mr',
 'punjabi': 'pa',
 'sinhala': 'si',
 'khmer': 'km',
 'shona': 'sn',
 'yoruba': 'yo',
 'somali': 'so',
 'afrikaans': 'af',
 'occitan': 'oc',
 'georgian': 'ka',
 'belarusian': 'be',
 'tajik': 'tg',
 'sindhi': 'sd',
 'gujarati': 'gu',
 'amharic': 'am',
 'yiddish': 'yi',
 'lao': 'lo',
 'uzbek': 'uz',
 'faroese': 'fo',
 'haitian creole': 'ht',
 'pashto': 'ps',
 'turkmen': 'tk',
 'nynorsk': 'nn',
 'maltese': 'mt',
 'sanskrit': 'sa',
 'luxembourgish': 'lb',
 'myanmar': 'my',
 'tibetan': 'bo',
 'tagalog': 'tl',
 'malagasy': 'mg',
 'assamese': 'as',
 'tatar': 'tt',
 'hawaiian': 'haw',
 'lingala': 'ln',
 'hausa': 'ha',
 'bashkir': 'ba',
 'javanese': 'jw',
 'sundanese': 'su',
 'burmese': 'my',
 'valencian': 'ca',
 'flemish': 'nl',
 'haitian': 'ht',
 'letzeburgesch': 'lb',
 'pushto': 'ps',
 'panjabi': 'pa',
 'moldavian': 'ro',
 'moldovan': 'ro',
 'sinhalese': 'si',
 'castilian': 'es'}</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/vq_stoks.py#L104" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="load_dataset" class="level3">
<h3 class="anchored" data-anchor-id="load_dataset">load_dataset</h3>
<blockquote class="blockquote">
<pre><code> load_dataset (atoks_shard_spec:str, stoks_shard_dir:str, samples:int,
               random_trunc_p:float=0, vq_codes:int=4096,
               language:str='en', weight:float=1, validation:bool=False,
               exclude_files:str=None, randomize_speakers:bool=False)</code></pre>
</blockquote>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>atoks_shard_spec</td>
<td>str</td>
<td></td>
<td>webdataset folder</td>
</tr>
<tr class="even">
<td>stoks_shard_dir</td>
<td>str</td>
<td></td>
<td>stoks webdataset base dir</td>
</tr>
<tr class="odd">
<td>samples</td>
<td>int</td>
<td></td>
<td>samples per epoch</td>
</tr>
<tr class="even">
<td>random_trunc_p</td>
<td>float</td>
<td>0</td>
<td>probability of truncating the input to less than 30 seconds</td>
</tr>
<tr class="odd">
<td>vq_codes</td>
<td>int</td>
<td>4096</td>
<td></td>
</tr>
<tr class="even">
<td>language</td>
<td>str</td>
<td>en</td>
<td></td>
</tr>
<tr class="odd">
<td>weight</td>
<td>float</td>
<td>1</td>
<td></td>
</tr>
<tr class="even">
<td>validation</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
<tr class="odd">
<td>exclude_files</td>
<td>str</td>
<td>None</td>
<td></td>
</tr>
<tr class="even">
<td>randomize_speakers</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/t2s_up_wds_mlang_enclm.py#L82" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="lang_to_id" class="level3">
<h3 class="anchored" data-anchor-id="lang_to_id">lang_to_id</h3>
<blockquote class="blockquote">
<pre><code> lang_to_id (lang)</code></pre>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>train_ds <span class="op">=</span> load_dataset(<span class="st">'wolnelektury-s2a-train/val.tar.gz'</span>, <span class="dv">512</span>, stoks_pad_token<span class="op">=</span><span class="dv">512</span>, language<span class="op">=</span><span class="st">'pl'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;module&gt;</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">1</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>1 train_ds = load_dataset(<span style="color: #808000; text-decoration-color: #808000">'wolnelektury-s2a-train/val.tar.gz'</span>, <span style="color: #0000ff; text-decoration-color: #0000ff">512</span>, stoks_pad_token=<span style="color: #0000ff; text-decoration-color: #0000ff">512</span>, l     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">TypeError: </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">load_dataset</span><span style="font-weight: bold">()</span> got an unexpected keyword argument <span style="color: #008000; text-decoration-color: #008000">'stoks_pad_token'</span>
</pre>
</div>
</div>
</section>
<section id="model" class="level2">
<h2 class="anchored" data-anchor-id="model">Model</h2>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L138" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="cmlmvisual" class="level3">
<h3 class="anchored" data-anchor-id="cmlmvisual">CMLMVisual</h3>
<blockquote class="blockquote">
<pre><code> CMLMVisual (model, masterbar, total_steps)</code></pre>
</blockquote>
<p>Visualize training progress</p>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L248" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="apply_rotary_pos_emb" class="level3">
<h3 class="anchored" data-anchor-id="apply_rotary_pos_emb">apply_rotary_pos_emb</h3>
<blockquote class="blockquote">
<pre><code> apply_rotary_pos_emb (q, k, cos, sin, query_subsampling:int=1,
                       key_subsampling:int=1)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L241" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="rotate_half" class="level3">
<h3 class="anchored" data-anchor-id="rotate_half">rotate_half</h3>
<blockquote class="blockquote">
<pre><code> rotate_half (x)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L219" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="rotary" class="level3">
<h3 class="anchored" data-anchor-id="rotary">Rotary</h3>
<blockquote class="blockquote">
<pre><code> Rotary (dim, base=10000)</code></pre>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in a tree structure. You can assign the submodules as regular attributes::</p>
<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))</code></pre>
<p>Submodules assigned in this way will be registered, and will have their parameters converted too when you call :meth:<code>to</code>, etc.</p>
<p>.. note:: As per the example above, an <code>__init__()</code> call to the parent class must be made before assignment on the child.</p>
<p>:ivar training: Boolean represents whether this module is in training or evaluation mode. :vartype training: bool</p>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L288" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="multiheadattention" class="level3">
<h3 class="anchored" data-anchor-id="multiheadattention">MultiHeadAttention</h3>
<blockquote class="blockquote">
<pre><code> MultiHeadAttention (n_state:int, n_head:int, qk_scale:float=1,
                     rope:bool=False, cross=False)</code></pre>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in a tree structure. You can assign the submodules as regular attributes::</p>
<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))</code></pre>
<p>Submodules assigned in this way will be registered, and will have their parameters converted too when you call :meth:<code>to</code>, etc.</p>
<p>.. note:: As per the example above, an <code>__init__()</code> call to the parent class must be made before assignment on the child.</p>
<p>:ivar training: Boolean represents whether this module is in training or evaluation mode. :vartype training: bool</p>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L256" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="residualattentionblock" class="level3">
<h3 class="anchored" data-anchor-id="residualattentionblock">ResidualAttentionBlock</h3>
<blockquote class="blockquote">
<pre><code> ResidualAttentionBlock (n_state:int, n_head:int,
                         cross_attention:bool=False, rope:bool=False,
                         qk_scale:float=1, ffn_mult:int=4)</code></pre>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in a tree structure. You can assign the submodules as regular attributes::</p>
<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))</code></pre>
<p>Submodules assigned in this way will be registered, and will have their parameters converted too when you call :meth:<code>to</code>, etc.</p>
<p>.. note:: As per the example above, an <code>__init__()</code> call to the parent class must be made before assignment on the child.</p>
<p>:ivar training: Boolean represents whether this module is in training or evaluation mode. :vartype training: bool</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>femb <span class="op">=</span> FlexEmbeddings(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">1</span>).half()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> torch.no_grad():</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    femb.main.weight[:] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    femb.main.weight[:,:<span class="dv">2</span>] <span class="op">=</span> torch.eye(<span class="dv">2</span>)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    femb.special.weight[:] <span class="op">=</span> torch.tensor([<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>])</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>femb.main.weight, femb.special.weight</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>(Parameter containing:
 tensor([[1., 0., 0.],
         [0., 1., 0.]], dtype=torch.float16, requires_grad=True),
 Parameter containing:
 tensor([[0., 0., 1.]], dtype=torch.float16, requires_grad=True))</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>embs <span class="op">=</span> femb(torch.tensor([[<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>]]))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>embs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[[1., 0., 0.],
         [0., 0., 1.],
         [0., 1., 0.],
         [1., 0., 0.]]], dtype=torch.float16, grad_fn=&lt;IndexPutBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>embs <span class="op">+=</span> femb(torch.tensor([[<span class="dv">0</span>]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>femb.unembed(embs.<span class="bu">float</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>torch.Size([1, 4, 2])
torch.Size([1, 4, 1])
torch.Size([1, 4, 3])</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[[2., 0., 0.],
         [1., 0., 1.],
         [1., 1., 0.],
         [2., 0., 0.]]], grad_fn=&lt;CatBackward0&gt;)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>amodel <span class="op">=</span> EncodecModel.encodec_model_24khz()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>amodel.quantizer.vq.layers[<span class="dv">0</span>].codebook</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>tensor([[ 5.3395, 13.1336, -3.3514,  ...,  2.2543, -4.5506,  3.7425],
        [ 2.5562, 13.8098, -5.7393,  ...,  0.4362, -2.5406,  1.5548],
        [ 3.9551, 12.0306, -6.5480,  ...,  1.6861, -5.3334,  1.3966],
        ...,
        [ 2.3868, 11.8062, -3.8374,  ..., -0.3132, -3.2393,  1.8929],
        [ 1.1349, 11.0860, -2.8491,  ..., -0.6624, -1.4591,  1.9885],
        [ 3.7719, 12.2859, -3.8640,  ...,  1.1728, -3.3949,  3.3238]])</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L600" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="sadelartransformer" class="level3">
<h3 class="anchored" data-anchor-id="sadelartransformer">SADelARTransformer</h3>
<blockquote class="blockquote">
<pre><code> SADelARTransformer (depth=3, ctx_n=2250, stoks_len=750, stoks_codes=4097,
                     stoks_width=None, spk_width=None, atoks_width=None,
                     n_head=3, head_width=64, ffn_mult=4, quantizers=8,
                     speaker_map={'1': 0}, tunables=Tunables(init_std=9,
                     embeddings_std=0.2, embeddings_lr_scale=10,
                     output_mult=5.6, query_mult=0.3,
                     encoder_depth_ratio=0.25, linear_heads=False,
                     rope=True, lr0=0.003, clip_gradient_norm=2,
                     weight_decay=0.001, warmup_steps=2000, random=False))</code></pre>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in a tree structure. You can assign the submodules as regular attributes::</p>
<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))</code></pre>
<p>Submodules assigned in this way will be registered, and will have their parameters converted too when you call :meth:<code>to</code>, etc.</p>
<p>.. note:: As per the example above, an <code>__init__()</code> call to the parent class must be made before assignment on the child.</p>
<p>:ivar training: Boolean represents whether this module is in training or evaluation mode. :vartype training: bool</p>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/vq_stoks.py#L161" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="tunables" class="level3">
<h3 class="anchored" data-anchor-id="tunables">Tunables</h3>
<blockquote class="blockquote">
<pre><code> Tunables (init_std:float=9, embeddings_std:float=0.2,
           embeddings_lr_scale:float=10, output_mult:float=5.6,
           query_mult:float=0.3, encoder_depth_ratio:float=0.25,
           linear_heads:bool=False, rope:bool=True, lr0:float=0.003,
           clip_gradient_norm:float=2, weight_decay:float=0.001,
           warmup_steps:float=2000, random:bool=False)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/vq_stoks.py#L154" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="rand" class="level3">
<h3 class="anchored" data-anchor-id="rand">rand</h3>
<blockquote class="blockquote">
<pre><code> rand (start, end)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/collabora/WhisperSpeech/blob/master/whisperspeech/s2a_delar_mup_wds_mlang.py#L477" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="delsumdecoder" class="level3">
<h3 class="anchored" data-anchor-id="delsumdecoder">DelSumDecoder</h3>
<blockquote class="blockquote">
<pre><code> DelSumDecoder (depth=6, n_head=6, head_width=64, atoks_width=None,
                qk_scale=1, ffn_mult=4, length=2250, codes=1024,
                quantizers=8, linear_heads=True, rope=False,
                pos_embs=None)</code></pre>
</blockquote>
<p>Base class for all neural network modules.</p>
<p>Your models should also subclass this class.</p>
<p>Modules can also contain other Modules, allowing to nest them in a tree structure. You can assign the submodules as regular attributes::</p>
<pre><code>import torch.nn as nn
import torch.nn.functional as F

class Model(nn.Module):
    def __init__(self):
        super().__init__()
        self.conv1 = nn.Conv2d(1, 20, 5)
        self.conv2 = nn.Conv2d(20, 20, 5)

    def forward(self, x):
        x = F.relu(self.conv1(x))
        return F.relu(self.conv2(x))</code></pre>
<p>Submodules assigned in this way will be registered, and will have their parameters converted too when you call :meth:<code>to</code>, etc.</p>
<p>.. note:: As per the example above, an <code>__init__()</code> call to the parent class must be made before assignment on the child.</p>
<p>:ivar training: Boolean represents whether this module is in training or evaluation mode. :vartype training: bool</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Automatic pdb calling has been turned ON</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>train_ds <span class="op">=</span> load_dataset(<span class="st">'libri'</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-medium-en+pl-512c-dim64.model'</span>).cuda()</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, train_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      0.00% [0/1 00:00&lt;?]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
</tbody>
</table>
<p>

    </p><div>
      <progress value="2" class="" max="16" style="width:300px; height:20px; vertical-align: middle;"></progress>
      12.50% [2/16 00:00&lt;00:03 #64/512 loss: 4.636 / nan]
    </div>
    
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'old-models/vqmodel-512c-dim64-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>small_ds).cuda()</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, small_ds, small_val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>27.1%</td><td></td><td>19.6%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 03:31&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>20000</td>
<td>3.26710</td>
<td>3.48323</td>
<td>03:31</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="625" class="" max="625" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [625/625 03:31&lt;00:00 #20000/20000 loss: 3.267 / 3.483]
    </div>
    
</div>
<div class="cell-output cell-output-stdout">
<pre><code>found NaN: small/3488/jungle_tw_0908_librivox_64kb_mp3/thejungle_04_sinclair_64kb_087
found NaN: small/2628/turmoil_0908_librivox_64kb_mp3/turmoil_23_tarkington_64kb_053
found NaN: small/3488/jungle_tw_0908_librivox_64kb_mp3/thejungle_07_sinclair_64kb_078</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-41-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># baseline</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>25.4%</td><td></td><td>18.5%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 09:45&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.43991</td>
<td>3.64125</td>
<td>03:15</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.26612</td>
<td>3.39851</td>
<td>06:13</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.15735</td>
<td>3.30149</td>
<td>09:10</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.16834</td>
<td>3.29321</td>
<td>09:45</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 09:45&lt;00:00 #160000/160000 loss: 3.168 / 3.293]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-42-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>25.6%</td><td></td><td>18.7%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:56&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.42783</td>
<td>3.63384</td>
<td>04:32</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.24147</td>
<td>3.39155</td>
<td>08:49</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.15337</td>
<td>3.29065</td>
<td>13:05</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.17545</td>
<td>3.28113</td>
<td>13:56</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:56&lt;00:00 #160000/160000 loss: 3.175 / 3.281]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-43-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>26.6%</td><td></td><td>21.7%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 09:54&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.30626</td>
<td>3.51887</td>
<td>03:17</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.10474</td>
<td>3.23221</td>
<td>06:18</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.00842</td>
<td>3.13535</td>
<td>09:18</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.01038</td>
<td>3.12537</td>
<td>09:54</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 09:53&lt;00:00 #160000/160000 loss: 3.010 / 3.125]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-44-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>28.4%</td><td></td><td>23.3%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:58&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.31771</td>
<td>3.37854</td>
<td>04:22</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.11682</td>
<td>3.12633</td>
<td>08:44</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.02503</td>
<td>3.01944</td>
<td>13:05</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.01330</td>
<td>3.01079</td>
<td>13:58</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:57&lt;00:00 #160000/160000 loss: 3.013 / 3.011]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-45-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>train_ds, val_ds <span class="op">=</span> load_datasets(<span class="st">'s2a-small/*.tar.gz'</span>, samples<span class="op">=</span><span class="dv">180000</span>)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>33.7%</td><td></td><td>27.5%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 15:48&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.06899</td>
<td>3.21095</td>
<td>04:24</td>
</tr>
<tr class="even">
<td>100000</td>
<td>2.84990</td>
<td>2.93317</td>
<td>08:47</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>2.77312</td>
<td>2.81134</td>
<td>13:10</td>
</tr>
<tr class="even">
<td>180000</td>
<td>2.73082</td>
<td>2.77786</td>
<td>15:48</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5625" class="" max="5625" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5625/5625 15:48&lt;00:00 #180000/180000 loss: 2.731 / 2.778]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-46-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>train_ds, val_ds <span class="op">=</span> load_datasets(<span class="st">'s2a-small/*.tar.gz'</span>, samples<span class="op">=</span><span class="dv">180000</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td><td>acc_start_0</td><td></td><td>acc_start_1</td><td></td></tr></thead><tbody><tr><td>33.7%</td><td></td><td>27.5%</td><td></td><td>37.9%</td><td></td><td>33.2%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 15:49&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.10401</td>
<td>3.20805</td>
<td>04:24</td>
</tr>
<tr class="even">
<td>100000</td>
<td>2.83302</td>
<td>2.92958</td>
<td>08:48</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>2.75915</td>
<td>2.80805</td>
<td>13:12</td>
</tr>
<tr class="even">
<td>180000</td>
<td>2.74166</td>
<td>2.77508</td>
<td>15:49</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5625" class="" max="5625" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5625/5625 15:49&lt;00:00 #180000/180000 loss: 2.742 / 2.775]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-47-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>train_ds, val_ds <span class="op">=</span> load_datasets(<span class="st">'s2a-small/*.tar.gz'</span>, samples<span class="op">=</span><span class="dv">180000</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td><td>acc_start_0</td><td></td><td>acc_start_1</td><td></td></tr></thead><tbody><tr><td>30.1%</td><td></td><td>23.4%</td><td></td><td>31.8%</td><td></td><td>26.8%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 15:51&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.04470</td>
<td>3.38566</td>
<td>04:23</td>
</tr>
<tr class="even">
<td>100000</td>
<td>2.93321</td>
<td>3.15460</td>
<td>08:48</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>2.76893</td>
<td>3.11252</td>
<td>13:13</td>
</tr>
<tr class="even">
<td>180000</td>
<td>2.71715</td>
<td>3.10554</td>
<td>15:51</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5625" class="" max="5625" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5625/5625 15:51&lt;00:00 #180000/180000 loss: 2.717 / 3.106]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-48-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb all, 400+ shards</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">1</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td></tr></thead><tbody><tr><td>27.5%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 12:33&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.08482</td>
<td>3.07243</td>
<td>03:55</td>
</tr>
<tr class="even">
<td>100000</td>
<td>2.85717</td>
<td>2.89056</td>
<td>07:51</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>2.79573</td>
<td>2.80195</td>
<td>11:46</td>
</tr>
<tr class="even">
<td>160000</td>
<td>2.79021</td>
<td>2.79402</td>
<td>12:33</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 12:33&lt;00:00 #160000/160000 loss: 2.790 / 2.794]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-49-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards, linear heads</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds, tunables<span class="op">=</span>Tunables(linear_heads<span class="op">=</span><span class="va">True</span>)).cuda()</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>28.4%</td><td></td><td>23.2%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:58&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.33196</td>
<td>3.38296</td>
<td>04:22</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.10307</td>
<td>3.11948</td>
<td>08:44</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.02954</td>
<td>3.01842</td>
<td>13:06</td>
</tr>
<tr class="even">
<td>160000</td>
<td>2.97770</td>
<td>3.01012</td>
<td>13:58</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:57&lt;00:00 #160000/160000 loss: 2.978 / 3.010]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-50-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards, linear heads</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds, tunables<span class="op">=</span>Tunables(linear_heads<span class="op">=</span><span class="va">True</span>)).cuda()</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>28.2%</td><td></td><td>23.1%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:50&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.30979</td>
<td>3.40961</td>
<td>04:20</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.10014</td>
<td>3.13427</td>
<td>08:39</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.06509</td>
<td>3.03229</td>
<td>12:59</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.05000</td>
<td>3.02330</td>
<td>13:51</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:50&lt;00:00 #160000/160000 loss: 3.050 / 3.023]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-51-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards, linear heads, EmbProj lr=10</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds, tunables<span class="op">=</span>Tunables(linear_heads<span class="op">=</span><span class="va">True</span>)).cuda()</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>28.0%</td><td></td><td>22.9%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:49&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.36395</td>
<td>3.41816</td>
<td>04:20</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.10823</td>
<td>3.15187</td>
<td>08:39</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.02961</td>
<td>3.04794</td>
<td>12:58</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.05585</td>
<td>3.03891</td>
<td>13:50</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:49&lt;00:00 #160000/160000 loss: 3.056 / 3.039]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-52-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards, linear heads, EmbProj lr=5</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds, tunables<span class="op">=</span>Tunables(linear_heads<span class="op">=</span><span class="va">True</span>)).cuda()</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>27.9%</td><td></td><td>22.8%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:48&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.35115</td>
<td>3.42734</td>
<td>04:18</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.14926</td>
<td>3.16296</td>
<td>08:37</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.03723</td>
<td>3.05682</td>
<td>12:56</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.05514</td>
<td>3.04801</td>
<td>13:48</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:48&lt;00:00 #160000/160000 loss: 3.055 / 3.048]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-53-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q, 400+ shards, linear heads</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds, tunables<span class="op">=</span>Tunables(linear_heads<span class="op">=</span><span class="va">True</span>)).cuda()</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span><span class="fl">1e-3</span>, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>27.3%</td><td></td><td>22.0%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:45&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.43349</td>
<td>3.51735</td>
<td>04:18</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.20685</td>
<td>3.21835</td>
<td>08:36</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.14143</td>
<td>3.11906</td>
<td>12:54</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.12234</td>
<td>3.11243</td>
<td>13:45</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:45&lt;00:00 #160000/160000 loss: 3.122 / 3.112]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-54-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 4Q, 400+ shards, linear heads</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>train_ds, val_ds <span class="op">=</span> load_datasets(<span class="st">'s2a-6454-4q/*.tar.gz'</span>, samples<span class="op">=</span><span class="dv">160000</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">4</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds, tunables<span class="op">=</span>Tunables(linear_heads<span class="op">=</span><span class="va">True</span>)).cuda()</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td><td>acc_2</td><td></td><td>acc_3</td><td></td></tr></thead><tbody><tr><td>27.2%</td><td></td><td>22.5%</td><td></td><td>20.8%</td><td></td><td>18.6%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 16:38&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.73575</td>
<td>3.80450</td>
<td>05:12</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.52139</td>
<td>3.51007</td>
<td>10:24</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.38680</td>
<td>3.39870</td>
<td>15:36</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.43426</td>
<td>3.39022</td>
<td>16:38</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 16:38&lt;00:00 #160000/160000 loss: 3.434 / 3.390]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-55-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'tiny'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>model.save_model(<span class="st">'s2a-tiny-wds-cross.model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>384 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>30.0%</td><td></td><td>25.3%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 30:15&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.19818</td>
<td>3.27087</td>
<td>09:27</td>
</tr>
<tr class="even">
<td>100000</td>
<td>2.94915</td>
<td>2.98427</td>
<td>18:55</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>2.85464</td>
<td>2.87508</td>
<td>28:22</td>
</tr>
<tr class="even">
<td>160000</td>
<td>2.82709</td>
<td>2.86586</td>
<td>30:15</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 30:15&lt;00:00 #160000/160000 loss: 2.827 / 2.866]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-56-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>train_ds, val_ds <span class="op">=</span> load_datasets(<span class="st">'whisperspeech-s2a-512c-dim64/*.tar.gz'</span>, samples<span class="op">=</span><span class="dv">67000</span>, stoks_pad_token<span class="op">=</span><span class="dv">512</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'tiny'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-256c-dim64-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">3</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>model.save_model(<span class="st">'s2a-512c-dim64-tiny-wds-cross-6454.model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>384 64 513</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td></tr></thead><tbody><tr><td>26.8%</td><td></td><td>22.4%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="3" class="" max="3" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [3/3 38:18&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.09247</td>
<td>3.59736</td>
<td>09:29</td>
</tr>
<tr class="even">
<td>100000</td>
<td>2.92941</td>
<td>3.28088</td>
<td>18:58</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>2.87256</td>
<td>3.16761</td>
<td>28:27</td>
</tr>
<tr class="even">
<td>200000</td>
<td>2.77072</td>
<td>3.07312</td>
<td>37:56</td>
</tr>
<tr class="odd">
<td>200928</td>
<td>2.80928</td>
<td>3.07167</td>
<td>38:18</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="2093" class="" max="2093" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [2093/2093 12:46&lt;00:00 #66976/67000 loss: 2.809 / 3.072]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-57-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>train_ds, val_ds <span class="op">=</span> load_datasets(<span class="st">'whisperspeech-s2a-512c/*.tar.gz'</span>, samples<span class="op">=</span><span class="dv">67000</span>, stoks_pad_token<span class="op">=</span><span class="dv">512</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'tiny'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-256c-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">3</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>model.save_model(<span class="st">'s2a-512c-tiny-wds-cross-6454.model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>384 32 513</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="0" class="" max="3" style="width:300px; height:20px; vertical-align: middle;"></progress>
      0.00% [0/3 00:00&lt;?]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>64</td>
<td>5.18270</td>
<td>0.00000</td>
<td>00:01</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="2" class="" max="2093" style="width:300px; height:20px; vertical-align: middle;"></progress>
      0.10% [2/2093 00:00&lt;15:47 #22/67000 loss: 4.619 / nan]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-58-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 4Q, 400+ shards, linear heads</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>train_ds, val_ds <span class="op">=</span> load_datasets(<span class="st">'s2a-6454-4q/*.tar.gz'</span>, samples<span class="op">=</span><span class="dv">160000</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'tiny'</span>, quantizers<span class="op">=</span><span class="dv">4</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds, tunables<span class="op">=</span>Tunables(linear_heads<span class="op">=</span><span class="va">True</span>)).cuda()</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>model.save_model(<span class="st">'s2a-tiny-4q-wds-cross.model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>384 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><thead><tr><td>acc_0</td><td></td><td>acc_1</td><td></td><td>acc_2</td><td></td><td>acc_3</td><td></td></tr></thead><tbody><tr><td>29.2%</td><td></td><td>25.0%</td><td></td><td>23.6%</td><td></td><td>21.4%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 33:08&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.55823</td>
<td>3.63592</td>
<td>10:22</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.24530</td>
<td>3.29306</td>
<td>20:43</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.12748</td>
<td>3.16482</td>
<td>31:04</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.15143</td>
<td>3.15668</td>
<td>33:08</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 33:08&lt;00:00 #160000/160000 loss: 3.151 / 3.157]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-59-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no xenc, emb 2Q</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>10.5%</td><td></td><td>8.9%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 12:23&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>4.38294</td>
<td>4.82997</td>
<td>03:52</td>
</tr>
<tr class="even">
<td>100000</td>
<td>4.36976</td>
<td>4.85217</td>
<td>07:45</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>4.48648</td>
<td>4.69173</td>
<td>11:37</td>
</tr>
<tr class="even">
<td>160000</td>
<td>4.53327</td>
<td>4.65840</td>
<td>12:23</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 12:23&lt;00:00 #160000/160000 loss: 4.533 / 4.658]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-60-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no xenc, emb 1Q</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>19.6%</td><td></td><td>13.3%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 12:19&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.74297</td>
<td>4.20712</td>
<td>03:51</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.65669</td>
<td>4.04836</td>
<td>07:42</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.72150</td>
<td>3.91123</td>
<td>11:33</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.74524</td>
<td>3.89218</td>
<td>12:19</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 12:19&lt;00:00 #160000/160000 loss: 3.745 / 3.892]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-61-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross, 1q, don't embed Q1 ;)</span></span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">1</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>14.6%</td><td></td></tr><tr><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 12:13&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.34288</td>
<td>4.00282</td>
<td>03:49</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.27247</td>
<td>3.88112</td>
<td>07:38</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.39283</td>
<td>3.73514</td>
<td>11:27</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.46310</td>
<td>3.71837</td>
<td>12:13</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 12:13&lt;00:00 #160000/160000 loss: 3.463 / 3.718]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-62-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cross, 1q</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">1</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>22.6%</td><td></td></tr><tr><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 12:17&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>2.86980</td>
<td>3.44263</td>
<td>03:50</td>
</tr>
<tr class="even">
<td>100000</td>
<td>2.82082</td>
<td>3.44939</td>
<td>07:41</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.00885</td>
<td>3.20670</td>
<td>11:32</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.04030</td>
<td>3.16246</td>
<td>12:18</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 12:17&lt;00:00 #160000/160000 loss: 3.040 / 3.162]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-63-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># crossattn, emb 2Q (replace, not add)</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> make_model(<span class="st">'micro'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds).cuda()</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>train(<span class="ss">f"s2a-new"</span>, model, train_ds, val_ds, half<span class="op">=</span><span class="va">True</span>, bs<span class="op">=</span><span class="dv">32</span>, lr<span class="op">=</span>model.tunables.lr0, epochs<span class="op">=</span><span class="dv">1</span>, warmup_steps<span class="op">=</span>model.tunables.warmup_steps,</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>      table_row_every_iters<span class="op">=</span><span class="dv">50000</span>, run_valid_every_iters<span class="op">=</span><span class="dv">10000</span>, visual_class<span class="op">=</span>CMLMVisual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>192 32 4097</code></pre>
</div>
<div class="cell-output cell-output-display">

</div>
<div class="cell-output cell-output-display">

<h5 class="anchored">Accuracies:</h5><table><tbody><tr><td>17.9%</td><td></td><td>11.5%</td><td></td></tr><tr><td>nan%</td><td></td><td>nan%</td><td></td></tr></tbody></table>
</div>
<div class="cell-output cell-output-display">

<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style>
</div>
<div class="cell-output cell-output-display">

    <div>
      <progress value="1" class="" max="1" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [1/1 13:38&lt;00:00]
    </div>
    

<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">samples</th>
<th data-quarto-table-cell-role="th">train</th>
<th data-quarto-table-cell-role="th">val</th>
<th data-quarto-table-cell-role="th">time</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>50016</td>
<td>3.67311</td>
<td>4.19860</td>
<td>04:16</td>
</tr>
<tr class="even">
<td>100000</td>
<td>3.67140</td>
<td>4.10176</td>
<td>08:31</td>
</tr>
<tr class="odd">
<td>150016</td>
<td>3.73631</td>
<td>3.94144</td>
<td>12:47</td>
</tr>
<tr class="even">
<td>160000</td>
<td>3.73755</td>
<td>3.91028</td>
<td>13:38</td>
</tr>
</tbody>
</table>
<p>

    </p><div>
      <progress value="5000" class="" max="5000" style="width:300px; height:20px; vertical-align: middle;"></progress>
      100.00% [5000/5000 13:38&lt;00:00 #160000/160000 loss: 3.738 / 3.910]
    </div>
    
</div>
<div class="cell-output cell-output-display">
<p><img src="4B. Multi-language semantic to acoustic token modeling_files/figure-html/cell-64-output-6.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>s2a <span class="op">=</span> make_model(<span class="st">'base'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'vqmodel-512c-dim64-4e-hyptuned-32gpu.model'</span>, dataset<span class="op">=</span>train_ds)</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>s2a.load_checkpoint(<span class="st">'vital-dust-70.ckpt'</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>s2a.save_model(<span class="st">'s2a-base-wds-cross-4e.model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>512 64 513</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>s2a <span class="op">=</span> make_model(<span class="st">'base'</span>, quantizers<span class="op">=</span><span class="dv">2</span>, spk_width<span class="op">=</span><span class="dv">192</span>, frozen_embeddings_model<span class="op">=</span><span class="st">'old-models/vqmodel-512c-dim64-4e-hyptuned-32gpu.model'</span>)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>s2a.load_checkpoint(<span class="st">'../s2a_delar_mup_wds-epoch=2-step=10591-val_loss=0.00.ckpt'</span>)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>s2a.save_model(<span class="st">'s2a-base-spkemb-gutenberg.model'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="color: #800000; text-decoration-color: #800000">╭─────────────────────────────── </span><span style="color: #800000; text-decoration-color: #800000; font-weight: bold">Traceback </span><span style="color: #bf7f7f; text-decoration-color: #bf7f7f; font-weight: bold">(most recent call last)</span><span style="color: #800000; text-decoration-color: #800000"> ────────────────────────────────╮</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">&lt;module&gt;</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2</span>                                                                                    <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">1 </span>s2a = make_model(<span style="color: #808000; text-decoration-color: #808000">'base'</span>, quantizers=<span style="color: #0000ff; text-decoration-color: #0000ff">2</span>, spk_width=<span style="color: #0000ff; text-decoration-color: #0000ff">192</span>, frozen_embeddings_model=<span style="color: #808000; text-decoration-color: #808000">'old-model</span>     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2 s2a.load_checkpoint(<span style="color: #808000; text-decoration-color: #808000">'../s2a_delar_mup_wds-epoch=2-step=10591-val_loss=0.00.ckpt'</span>)            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">3 </span>s2a.save_model(<span style="color: #808000; text-decoration-color: #808000">'s2a-base-spkemb-gutenberg.model'</span>)                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">4 </span>                                                                                             <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">load_checkpoint</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">276</span>                                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">273 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">assert</span> <span style="color: #808000; text-decoration-color: #808000">'pytorch-lightning_version'</span> <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> spec, <span style="color: #808000; text-decoration-color: #808000">'not a valid PyTorch Lightning check</span>   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">274 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>state_dict = {k.replace(<span style="color: #808000; text-decoration-color: #808000">'model.'</span>, <span style="color: #808000; text-decoration-color: #808000">''</span>):v                                            <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">275 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │     </span><span style="color: #0000ff; text-decoration-color: #0000ff">for</span> k,v <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> spec[<span style="color: #808000; text-decoration-color: #808000">'state_dict'</span>].items()}                               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>276 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.load_state_dict(state_dict)                                                   <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">277 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> <span style="color: #00ffff; text-decoration-color: #00ffff">self</span>                                                                        <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">278 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span>                                                                                       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">279 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   </span><span style="color: #0000ff; text-decoration-color: #0000ff">def</span> <span style="color: #00ff00; text-decoration-color: #00ff00">save_model</span>(<span style="color: #00ffff; text-decoration-color: #00ffff">self</span>, fname):                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #bfbf7f; text-decoration-color: #bfbf7f">/opt/conda/lib/python3.10/site-packages/torch/nn/modules/</span><span style="color: #808000; text-decoration-color: #808000; font-weight: bold">module.py</span>:<span style="color: #0000ff; text-decoration-color: #0000ff">2041</span> in <span style="color: #00ff00; text-decoration-color: #00ff00">load_state_dict</span>       <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>                                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2038 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │   │   </span><span style="color: #808000; text-decoration-color: #808000">', '</span>.join(<span style="color: #808000; text-decoration-color: #808000">'"{}"'</span>.format(k) <span style="color: #0000ff; text-decoration-color: #0000ff">for</span> k <span style="color: #ff00ff; text-decoration-color: #ff00ff">in</span> missing_keys)))               <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2039 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span>                                                                                  <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2040 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">if</span> <span style="color: #00ffff; text-decoration-color: #00ffff">len</span>(error_msgs) &gt; <span style="color: #0000ff; text-decoration-color: #0000ff">0</span>:                                                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span> <span style="color: #800000; text-decoration-color: #800000">❱ </span>2041 <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">raise</span> <span style="color: #00ffff; text-decoration-color: #00ffff">RuntimeError</span>(<span style="color: #808000; text-decoration-color: #808000">'Error(s) in loading state_dict for {}:\n\t{}'</span>.format(     <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2042 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   │   │   │   │   │      </span><span style="color: #00ffff; text-decoration-color: #00ffff">self</span>.<span style="color: #ff0000; text-decoration-color: #ff0000">__class__</span>.<span style="color: #ff0000; text-decoration-color: #ff0000">__name__</span>, <span style="color: #808000; text-decoration-color: #808000">"\n\t"</span>.join(error_msgs)))         <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2043 </span><span style="color: #7f7f7f; text-decoration-color: #7f7f7f">│   │   </span><span style="color: #0000ff; text-decoration-color: #0000ff">return</span> _IncompatibleKeys(missing_keys, unexpected_keys)                           <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">│</span>   <span style="color: #7f7f7f; text-decoration-color: #7f7f7f">2044 </span>                                                                                          <span style="color: #800000; text-decoration-color: #800000">│</span>
<span style="color: #800000; text-decoration-color: #800000">╰──────────────────────────────────────────────────────────────────────────────────────────────────╯</span>
<span style="color: #ff0000; text-decoration-color: #ff0000; font-weight: bold">RuntimeError: </span><span style="color: #800080; text-decoration-color: #800080; font-weight: bold">Error</span><span style="font-weight: bold">(</span>s<span style="font-weight: bold">)</span> in loading state_dict for SADelARTransformer:
        Missing <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">key</span><span style="font-weight: bold">(</span>s<span style="font-weight: bold">)</span> in state_dict: <span style="color: #008000; text-decoration-color: #008000">"emb_to_hidden.weight"</span>, <span style="color: #008000; text-decoration-color: #008000">"emb_to_hidden.bias"</span>. 
        size mismatch for semantic_embedding.weight: copying a param with shape <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">torch.Size</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">4097</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">512</span><span style="font-weight: bold">])</span> from 
checkpoint, the shape in current model is <span style="color: #800080; text-decoration-color: #800080; font-weight: bold">torch.Size</span><span style="font-weight: bold">([</span><span style="color: #008080; text-decoration-color: #008080; font-weight: bold">513</span>, <span style="color: #008080; text-decoration-color: #008080; font-weight: bold">64</span><span style="font-weight: bold">])</span>.
</pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>